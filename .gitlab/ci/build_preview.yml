# Demo generation for preview app
eas_build_preview:
  stage: build_preview
  image: node:alpine
  tags: [minds-ci]
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
      - ../yarn
  before_script:
    - apk add --no-cache bash git
    - yarn install --cache-folder ../yarn
  script:
    - echo "Building preview for tenant $TENANT_ID..."
    - wget -O config.zip $ZIP_FILE
    - unzip -o config.zip
    - cp ./preview/tenant/patches/* ./patches
    - npx eas-cli update --branch "$TENANT_ID" --message "preview"
  rules:
    - if: $BUILD_MODE == 'PREVIEW_ZIP'
