# Run only for tags that don't end on .0 (patch releases)
.only_patch_release:
  rules:
    - if: $CI_COMMIT_TAG !~ /.*\.0$/ && $CI_COMMIT_TAG != null

# Run only on master
.only_master:
  only:
    refs:
      - master

.codepush_base:
  image: node:14.19.1
  tags: [minds-ci]
  stage: pushrelease
  before_script:
    - npm install -g patch-package
    - npm install -g appcenter-cli
    - yarn install

pushrelease_staging:ios:
  extends:
    - .only_master
    - .codepush_base
  script:
    - appcenter codepush release-react -a Minds/Minds-iOS -d Staging

pushrelease_staging:android:
  extends:
    - .only_master
    - .codepush_base
  script:
    - appcenter codepush release-react -a Minds/Minds -d Staging

pushrelease_prod:ios:
  extends:
    - .only_patch_release
    - .codepush_base
  script:
    - appcenter codepush release-react -a Minds/Minds-iOS -d Staging

pushrelease_prod:android:
  extends:
    - .only_patch_release
    - .codepush_base
  script:
    - appcenter codepush release-react -a Minds/Minds -d Staging
