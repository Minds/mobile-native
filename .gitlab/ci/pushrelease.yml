.codepush_base:
  image: node:14.19.1
  tags: [minds-ci]
  stage: pushrelease
  needs: ['test:quality']
  before_script:
    - npm install -g patch-package
    - npm install -g appcenter-cli
    - yarn install
    - export RELEASE_VERSION=${CI_COMMIT_TAG:1}

pushrelease_staging:ios:
  extends:
    - .codepush_base
    - .only_develop
  environment: codepush_staging_ios
  script:
    - appcenter codepush release-react -a Minds/Minds-iOS -d Staging

pushrelease_staging:android:
  extends:
    - .codepush_base
    - .only_develop
  environment: codepush_staging_android
  script:
    - appcenter codepush release-react -a Minds/Minds -d Staging

pushrelease_prod:ios:
  extends:
    - .codepush_base
    - .rule_patch_release
  environment: codepush_production_ios
  script:
    - APP_VERSION=$RELEASE_VERSION appcenter codepush release-react -a Minds/Minds-iOS -d Production

pushrelease_prod:android:
  extends:
    - .codepush_base
    - .rule_patch_release
  environment: codepush_production_android
  script:
    - APP_VERSION=$RELEASE_VERSION appcenter codepush release-react -a Minds/Minds -d Production
